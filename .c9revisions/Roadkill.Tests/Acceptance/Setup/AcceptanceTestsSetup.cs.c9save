{"ts":1354889194435,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿using System;\r\nusing System.Collections.Generic;\r\nusing System.Diagnostics;\r\nusing System.IO;\r\nusing System.Linq;\r\nusing System.Text;\r\nusing NUnit.Framework;\r\nusing OpenQA.Selenium;\r\nusing OpenQA.Selenium.Chrome;\r\nusing OpenQA.Selenium.Firefox;\r\nusing SimpleBrowser.WebDriver;\r\n\r\nnamespace Roadkill.Tests.Acceptance\r\n{\r\n\t[SetUpFixture]\r\n\tpublic class AcceptanceTestsSetup\r\n\t{\r\n\t\tpublic static IWebDriver Driver { get; private set; }\r\n\t\tpublic static Process IisProcess { get; private set; }\r\n\r\n\t\t[SetUp]\r\n\t\tpublic void BeforeAllTests()\r\n\t\t{\r\n\t\t\tCopyWebConfig();\r\n\t\t\tLaunchIisExpress();\r\n\r\n\t\t\t//Driver = new SimpleBrowserDriver();\r\n\t\t\t//Driver = new FirefoxDriver();\r\n\t\t\tDriver = new ChromeDriver();\r\n\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tDriver.Manage().Timeouts().ImplicitlyWait(TimeSpan.FromSeconds(2));\r\n\t\t\t}\r\n\t\t\tcatch (NotImplementedException) { }\r\n\t\t}\r\n\r\n\t\t[TearDown]\r\n\t\tpublic void AfterAllTests()\r\n\t\t{\r\n\t\t\tDriver.Quit();\r\n\r\n\t\t\tif (IisProcess != null && !IisProcess.HasExited)\r\n\t\t\t{\r\n\t\t\t\tIisProcess.CloseMainWindow();\r\n\t\t\t\tIisProcess.Dispose();\r\n\t\t\t\tConsole.WriteLine(\"Killed IISExpress\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic static string GetSitePath()\r\n\t\t{\r\n\t\t\tstring sitePath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, \"..\", \"..\", \"..\", \"Roadkill.Site\");\r\n\t\t\tsitePath = new DirectoryInfo(sitePath).FullName;\r\n\r\n\t\t\treturn sitePath;\r\n\t\t}\r\n\r\n\t\tprivate void CopyWebConfig()\r\n\t\t{\r\n\t\t\tstring sitePath = GetSitePath();\r\n\t\t\tstring libFolder = Path.Combine(sitePath, \"..\", \"lib\");\r\n\t\t\tlibFolder = new DirectoryInfo(libFolder).FullName;\r\n\r\n\t\t\tstring testsWebConfigPath = Path.Combine(libFolder, \"Configs\", \"web.acceptancetests.config\");\r\n\r\n\t\t\t// Be a good neighbour and backup the web.config\r\n\t\t\tstring siteWebConfig = Path.Combine(sitePath, \"web.config\");\r\n\t\t\tFile.Copy(siteWebConfig, siteWebConfig + \".bak\", true);\r\n\t\t\tConsole.WriteLine(\"Backed up web.config to {0}.bak\", siteWebConfig);\r\n\r\n\t\t\tFile.Copy(testsWebConfigPath, siteWebConfig, true);\r\n\t\t\tConsole.WriteLine(\"Copied web.config from '{0}' to '{1}'\", testsWebConfigPath, siteWebConfig);\r\n\t\t}\r\n\r\n\t\tprivate void LaunchIisExpress()\r\n\t\t{\r\n\t\t\tstring sitePath = GetSitePath();\r\n\t\t\tProcessStartInfo startInfo = new ProcessStartInfo();\r\n\t\t\tstartInfo.Arguments = string.Format(\"/path:\\\"{0}\\\" /port:{1}\", sitePath, 9876);\r\n\r\n\t\t\tstring programfiles = programfiles = Environment.GetFolderPath(Environment.SpecialFolder.ProgramFiles);\r\n\t\t\tstring searchPath1 = string.Format(@\"{0}\\IIS Express\\iisexpress.exe\", programfiles);\r\n\t\t\tstring searchPath2 = \"\";\r\n\t\t\tstartInfo.FileName = string.Format(@\"{0}\\IIS Express\\iisexpress.exe\", programfiles);\r\n\r\n\t\t\tif (!File.Exists(startInfo.FileName))\r\n\t\t\t{\r\n\t\t\t\tprogramfiles = Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86);\r\n\t\t\t\tsearchPath2 = string.Format(@\"{0}\\IIS Express\\iisexpress.exe\", programfiles);\r\n\t\t\t\tstartInfo.FileName = string.Format(@\"{0}\\IIS Express\\iisexpress.exe\", programfiles);\r\n\t\t\t}\r\n\r\n\t\t\tif (!File.Exists(startInfo.FileName))\r\n\t\t\t{\r\n\t\t\t\tthrow new FileNotFoundException(string.Format(\"IIS Express is not installed in '{0}' or '{1}' and is required for the acceptance tests\\n \" +\r\n\t\t\t\t\t\"Download it from http://www.microsoft.com/en-gb/download/details.aspx?id=1038\",\r\n\t\t\t\t\tsearchPath1, searchPath2));\r\n\t\t\t}\r\n\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tConsole.WriteLine(\"Launching IIS Express from {0}\", startInfo.FileName);\r\n\t\t\t\tIisProcess = Process.Start(startInfo);\r\n\t\t\t}\r\n\t\t\tcatch\r\n\t\t\t{\r\n\t\t\t\tIisProcess.CloseMainWindow();\r\n\t\t\t\tIisProcess.Dispose();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":3454}]],"length":3454}
{"contributors":[],"silentsave":false,"ts":1354889148490,"patch":[[{"diffs":[[-1,"﻿"],[0,"usin"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0,"ress"],[1,":"],[0," "],[-1,"from {0}"],[0,"\", s"]],"start1":3267,"start2":3267,"length1":17,"length2":10},{"diffs":[[0,"artInfo."],[-1,"FileName"],[1,"ToString()"],[0,");\r\n\t\t\t\t"]],"start1":3278,"start2":3278,"length1":24,"length2":26}]],"length":3448,"saved":false}
{"contributors":[],"silentsave":false,"ts":1354889494013,"patch":[[{"diffs":[[-1,"﻿"],[0,"usin"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0,"iver();\r\n\t\t\t"],[-1,"//"],[0,"Driver = new"]],"start1":622,"start2":622,"length1":26,"length2":24},{"diffs":[[0,"oxDriver();\r\n\t\t\t"],[1,"//"],[0,"Driver = new Chr"]],"start1":652,"start2":652,"length1":32,"length2":34},{"diffs":[[0,"ress"],[-1," from {0"],[1,": {0} {1"],[0,"}\", "]],"start1":3267,"start2":3267,"length1":16,"length2":16},{"diffs":[[0,"FileName"],[1,", startInfo.Arguments"],[0,");\r\n\t\t\t\t"]],"start1":3293,"start2":3293,"length1":16,"length2":37}]],"length":3474,"saved":false}
{"ts":1354890522758,"patch":[[{"diffs":[[0,"iver();\r\n\t\t\t"],[1,"//"],[0,"Driver = new"]],"start1":622,"start2":622,"length1":24,"length2":26},{"diffs":[[0,"oxDriver();\r\n\t\t\t"],[-1,"//"],[0,"Driver = new Chr"]],"start1":654,"start2":654,"length1":34,"length2":32}]],"length":3474,"saved":false}
