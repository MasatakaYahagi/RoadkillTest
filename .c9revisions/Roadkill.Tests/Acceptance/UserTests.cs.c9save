{"ts":1354887861309,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿using System;\r\nusing System.Text;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing Roadkill.Core;\r\nusing Roadkill.Tests.Core;\r\nusing NUnit.Framework;\r\nusing System.IO;\r\n\r\nusing Plasma.Core;\r\nusing Plasma.WebDriver;\r\nusing OpenQA.Selenium;\r\nusing System.Diagnostics;\r\nusing HtmlAgilityPack;\r\nusing Fizzler.Systems.HtmlAgilityPack;\r\nusing SimpleBrowser.WebDriver;\r\nusing System.Threading;\r\nusing OpenQA.Selenium.Firefox;\r\n\r\nnamespace Roadkill.Tests.Acceptance\r\n{\r\n\t/// <summary>\r\n\t/// Web tests using a headless browser (non-javascript interaction)\r\n\t/// </summary>\r\n\t[TestFixture]\r\n\t[Category(\"Acceptance\")]\r\n\t[Explicit]\r\n\tpublic class UserTests : AcceptanceTestBase\r\n\t{\r\n\t\t[Test]\r\n\t\tpublic void Reset_Password_Sends_Email()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tforeach (string file in Directory.GetFiles(@\"C:\\inetpub\\temp\\smtp\\\", \"*.eml\"))\r\n\t\t\t{\r\n\t\t\t\tFile.Delete(file);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/user/resetpassword']\")).Click();\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(ADMIN_EMAIL);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value='Reset password']\")).Click();\r\n\t\t\t\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#content h1\"))[0].Text, Contains.Substring(\"Your password reset request was sent.\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#content p\")).Text, Contains.Substring(\"Thank you, an email has been sent to admin@localhost with details on how to reset your password.\"));\r\n\t\t\tAssert.That(Directory.GetFiles(@\"C:\\inetpub\\temp\\smtp\\\", \"*.eml\").Count(), Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void Profile_Shows_Correct_Information()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(ADMIN_EMAIL);\r\n\t\t\tDriver.FindElement(By.Name(\"password\")).SendKeys(ADMIN_PASSWORD);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Login]\")).Click();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/user/profile']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Firstname\")).GetAttribute(\"value\"), Is.EqualTo(\"Chris\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Lastname\")).GetAttribute(\"value\"), Is.EqualTo(\"Admin\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#NewEmail\")).GetAttribute(\"value\"), Is.EqualTo(\"admin@localhost\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#NewUsername\")).GetAttribute(\"value\"), Is.EqualTo(\"admin\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Password\")).GetAttribute(\"value\"), Is.EqualTo(\"\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#PasswordConfirmation\")).GetAttribute(\"value\"), Is.EqualTo(\"\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void Save_Profile_Shows_Correct_Information()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(ADMIN_EMAIL);\r\n\t\t\tDriver.FindElement(By.Name(\"password\")).SendKeys(ADMIN_PASSWORD);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Login]\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/user/profile']\")).Click();\t\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Firstname\")).Clear();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Firstname\")).SendKeys(\"NewFirstName\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Lastname\")).Clear();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Lastname\")).SendKeys(\"NewLastName\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/user/profile']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Firstname\")).GetAttribute(\"value\"), Is.EqualTo(\"NewFirstName\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Lastname\")).GetAttribute(\"value\"), Is.EqualTo(\"NewLastName\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#NewEmail\")).GetAttribute(\"value\"), Is.EqualTo(\"admin@localhost\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#NewUsername\")).GetAttribute(\"value\"), Is.EqualTo(\"admin\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#Password\")).GetAttribute(\"value\"), Is.EqualTo(\"\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#PasswordConfirmation\")).GetAttribute(\"value\"), Is.EqualTo(\"\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void Save_Profile_Password_Changes_Password()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(EDITOR_EMAIL);\r\n\t\t\tDriver.FindElement(By.Name(\"password\")).SendKeys(EDITOR_PASSWORD);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Login]\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/user/profile']\")).Click();\t\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Password\")).Clear();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Password\")).SendKeys(\"newpassword\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#PasswordConfirmation\")).Clear();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#PasswordConfirmation\")).SendKeys(\"newpassword\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(EDITOR_EMAIL);\r\n\t\t\tDriver.FindElement(By.Name(\"password\")).SendKeys(\"newpassword\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Login]\")).Click();\r\n\t\t\t\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#loggedinas a\")).Text, Is.EqualTo(\"Logged in as editor\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void All_Pages_Has_Edit_Delete_For_Admin()\r\n\t\t{\r\n\t\t\t//\r\n\t\t\t// Arrange\r\n\t\t\t//\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.Navigate().GoToUrl(LoginUrl);\r\n\t\t\tDriver.FindElement(By.Name(\"email\")).SendKeys(ADMIN_EMAIL);\r\n\t\t\tDriver.FindElement(By.Name(\"password\")).SendKeys(ADMIN_PASSWORD);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Login]\")).Click();\r\n\r\n\t\t\t// 1st new page\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/new']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#Title\")).SendKeys(\"My title1\");\r\n\r\n\t\t\tif (Driver is SimpleBrowserDriver)\r\n\t\t\t{\r\n\t\t\t\tDriver.FindElement(By.Name(\"RawTags\")).SendKeys(\"Homepage\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tDriver.FindElement(By.Name(\"TagsEntry\")).SendKeys(\"Homepage\");\r\n\t\t\t\tDriver.FindElement(By.Name(\"TagsEntry\")).SendKeys(Keys.Space);\r\n\t\t\t}\r\n\t\t\tDriver.FindElement(By.Name(\"Content\")).SendKeys(\"Some content goes here1\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\r\n\t\t\t// 2nd new page\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/new']\")).Click();\r\n\t\t\tDriver.FindElement(By.Name(\"Title\")).SendKeys(\"My title2\");\r\n\t\t\tif (Driver is SimpleBrowserDriver)\r\n\t\t\t{\r\n\t\t\t\tDriver.FindElement(By.Name(\"RawTags\")).SendKeys(\"Tag2\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tDriver.FindElement(By.Name(\"TagsEntry\")).SendKeys(\"Tag2\");\r\n\t\t\t\tDriver.FindElement(By.Name(\"TagsEntry\")).SendKeys(Keys.Space);\r\n\t\t\t}\r\n\t\t\tDriver.FindElement(By.Name(\"Content\")).SendKeys(\"Some content goes here2\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\r\n\t\t\t//\r\n\t\t\t// Act\r\n\t\t\t//\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table>tbody>tr\")).Count, Is.EqualTo(2));\r\n\t\t}\r\n\t}\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":7428}]],"length":7428}
{"contributors":[],"silentsave":false,"ts":1354887782970,"patch":[[{"diffs":[[-1,"﻿"],[0,"usin"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0,")]\r\n"],[-1,"\t[Explicit]\r\n"],[0,"\tpub"]],"start1":617,"start2":617,"length1":21,"length2":8}]],"length":7414,"saved":false}
