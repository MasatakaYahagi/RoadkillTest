var Roadkill;(function(n){(function(n){$(document).ready(function(){var i=new n.WysiwygEditor;i.bindEvents(),t.bindPreviewButton()});var t=function(){function t(){}return t.initializeTagManager=function(n){$("#TagsEntry").typeahead({}),$("#TagsEntry").tagsManager({tagClass:"tm-tag-success",prefilled:n,preventSubmitOnEnter:!0,typeahead:!0,typeaheadAjaxMethod:"POST",typeaheadAjaxSource:ROADKILL_TAGAJAXURL,blinkBGColor_1:"#FFFF9C",blinkBGColor_2:"#CDE69C",delimeters:[44,186,32,9],hiddenTagListName:"RawTags",tagCloseIcon:"×",preventSubmitOnEnter:!1,validator:function(n){var i=t.isValidTag(n);return i===!1&&toastr.error("The following characters are not valid for tags: <br/>"+t._tagBlackList.join(" ")),i}}),$("#TagsEntry").keydown(function(n){var r=n.keyCode||n.which,i;return r=="9"?(i=$("#TagsEntry").val(),t.isValidTag(i)&&$("#Content").focus(),!1):!0}),$("#TagsEntry").blur(function(){$("#TagsEntry").tagsManager("pushTag",$("#TagsEntry").val()),$(".tm-tag-remove").each(function(){$(this).text("×")}),$(".tm-tag").each(function(){$(this).addClass("tm-tag-success"),$(this).addClass("tm-success")})})},t.isValidTag=function(n){for(var i=0;i<n.length;i++)if($.inArray(n[i],t._tagBlackList)>-1)return!1;return!0},t.bindPreviewButton=function(){$(".previewButton").click(function(){t.showPreview()})},t.showPreview=function(){$("#previewLoading").show();var i=$("#Content").val(),t=$.ajax({type:"POST",url:ROADKILL_PREVIEWURL,data:{id:i},cache:!1,dataType:"text"});t.done(function(n){$("#preview").html(n)}),t.fail(function(n,t,i){$("#preview").html("<span style='color:red'>An error occurred with the preview: "+i+"<\/span>")}),t.always(function(){$("#previewLoading").show(),n.Dialogs.openFullScreenModal("#previewContainer"),$("#previewLoading").hide()})},t._tagBlackList=[";","/","?",":","@","&","=","{","}","|","\\","^","[","]","`"],t}();n.EditPage=t})(n.Site||(n.Site={}));var t=n.Site})(Roadkill||(Roadkill={}))